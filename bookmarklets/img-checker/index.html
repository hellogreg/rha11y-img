<!DOCTYPE html>
<html lang="en">
  <!-- https://rha11y-tools.netlify.app/bookmarklets/img-checker/index.html -->
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Image Checker Bookmarklet</title>
    <link rel="stylesheet" href="img-checker.css" rel="stylesheet" />
    <script src="img-components.js"></script>
  </head>
  <body>
    <h1>A11y image tests</h1>
    <!--
    <p>
      Drag the following link to your bookmarks bar for testing. This bookmarklet loads the current
      production version of the img-checker script every time you run it.
    </p>
    <p>
      <a
        href='javascript: (function () {var bookletCode = document.createElement("script");bookletCode.setAttribute("src", "https://rha11y-tools.netlify.app/bookmarklets/img-checker/img-checker.js");document.body.appendChild(bookletCode);})();'
        >rha11yimg</a
      >
    </p>
    <p>
      If the above doesn't work, the site you're testing may not allow remote scripts to run. In
      that case, drag the following link to you bookmarks bar. This is the current version of the
      bookmarklet, but it won't update automatically. You may want to check back here on occasion.
    </p>
    <p>
      <a
        href='javascript:(()=>{let e=!0;function t(t){e&&(t=void 0!==t?t:"-----------------",console.log(t))}function i(t){e&&t&&console.dir(t)}function o(e,t){let i="#eee";i=t?"#09f":"#f90",e.style.setProperty("outline",i+" solid 8px","important"),e.setAttribute("data-a11y","Accessible: "+!!t)}function l(e){if(t("Has alt attribute: "+(hasAlt=e.hasAttribute("alt"))),hasAlt){let i=e.getAttribute("alt")||"[decorative]";t("Image alt value: "+i)}return hasAlt}function n(e){function i(e){let i;t("Checking if "+e.nodeName+" is hidden"),i=i||!!e.hidden;try{i=i||e.ariaHidden||"true"===e.getAttribute("aria-hidden")}catch(o){i=i||e.ariaHidden,t("Cannot test "+e.nodeName+" for aria-hidden attribute.")}try{i=i||"presentation"===e.getAttribute("role")}catch(l){t("Cannot test "+e.nodeName+" for role attribute.")}try{i=i||"none"===getComputedStyle(e).display}catch(n){t("Cannot test "+e.nodeName+" for computed style.")}return!!i}t("Checking if element is hidden");let o=i(e);return t("Image hidden from AT: "+!!o),o||(t("Checking if any parents are hidden"),o=o||function e(t){let o,l=t.parentNode;for(;!o&&l&&"BODY"!==l.nodeName&&l.nodeName;)o=o||i(l),l=l.parentNode;return o}(e)),t("Element or parent is hidden: "+o),!!o}function r(e){t("Checking if image is accessible");let i=e.src?e.src:"[unspecified]",r=e.id?e.id:"[unspecified]";t("src: "+i),t("id: "+r);let a=!!(l(e)||n(e));t("image is accessible: "+a),o(e,a),t()}function a(e){var i,l;t("Checking if inline svg is accessible"),e.id&&e.id;let r,a,d,s=(a=(r=(i=e).querySelector("svg > title"))&&r.textContent,t("Has <title>: "+!!a),t("title: "+(a?e.querySelector("svg > title").textContent:"[unspecified]")),!!a&&(d="img"===(l=e).getAttribute("role"),t("Has role=img: "+!!d),!!d));s=s||n(e),t("svg is accessible: "+s),o(e,s),t()}function d(){let e=document.querySelectorAll("svg");for(let t of e)a(t);let i=document.querySelectorAll("img");for(let o of i)r(o)}function s(){function e(i,o){o=o+1||1;let l=i.querySelectorAll("*");for(let n of l){let a=n.shadowRoot;if(a){t("Found a shadow child (nesting level "+o+"): "+a.lastElementChild.localName);let d=a.querySelectorAll("svg");for(let s of d)t("Found svg in level "+o+" shadowRoot"),r(s);let c=a.querySelectorAll("img");for(let u of c)t("Found img in level "+o+" shadowRoot"),r(u);e(a,o)}}}let i=document.querySelectorAll("*");for(let o of i){let l=o.shadowRoot;if(l){t("Found a top-level shadowRoot: "+l.lastElementChild.localName),e(l);let n=o.shadowRoot.querySelectorAll("svg");for(let d of n)t("Found svg in top-level shadowRoot"),a(d);let s=l.querySelectorAll("img");for(let c of s)t("Found img in top-level shadowRoot"),r(c)}}}setTimeout(()=>{t("Initiating image test bookmarklet."),t(),d(),s()},0)})();'
        >rhallyimg (local)</a
      >
      [Version 0.20221231]
    </p>
    -->
    <ul>
      <li>Blue outline: passes a11y check</li>
      <li>Orange outline: fails a11y check</li>
      <li>No outline: image not identified/tested</li>
    </ul>
    <h2>Inline SVGs</h2>
    <div class="cards">
      <div>
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 200 145"
          class="redhat-logo"
          id="svg01"
        >
          <path
            d="M127.47 83.49c12.51 0 30.61-2.58 30.61-17.46a14 14 0 0 0-.31-3.42l-7.45-32.36c-1.72-7.12-3.23-10.35-15.73-16.6C124.89 8.69 103.76.5 97.51.5 91.69.5 90 8 83.06 8c-6.68 0-11.64-5.6-17.89-5.6-6 0-9.91 4.09-12.93 12.5 0 0-8.41 23.72-9.49 27.16a6.43 6.43 0 0 0-.22 1.94c0 9.22 36.3 39.45 84.94 39.45M160 72.07c1.73 8.19 1.73 9.05 1.73 10.13 0 14-15.74 21.77-36.43 21.77-46.76.03-87.72-27.37-87.72-45.48a18.45 18.45 0 0 1 1.51-7.33C22.27 52 .5 55 .5 74.22c0 31.48 74.59 70.28 133.65 70.28 45.28 0 56.7-20.48 56.7-36.65 0-12.72-11-27.16-30.83-35.78"
            fill="#e00"
          ></path>
        </svg>
        <ul>
          <li>Inline svg</li>
          <li>No title or img role</li>
          <li>Not hidden from AT</li>
          <li>Should <strong>fail</strong></li>
        </ul>
      </div>
      <div>
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 200 145"
          class="redhat-logo"
          id="svg02"
          aria-hidden="true"
        >
          <path
            d="M127.47 83.49c12.51 0 30.61-2.58 30.61-17.46a14 14 0 0 0-.31-3.42l-7.45-32.36c-1.72-7.12-3.23-10.35-15.73-16.6C124.89 8.69 103.76.5 97.51.5 91.69.5 90 8 83.06 8c-6.68 0-11.64-5.6-17.89-5.6-6 0-9.91 4.09-12.93 12.5 0 0-8.41 23.72-9.49 27.16a6.43 6.43 0 0 0-.22 1.94c0 9.22 36.3 39.45 84.94 39.45M160 72.07c1.73 8.19 1.73 9.05 1.73 10.13 0 14-15.74 21.77-36.43 21.77-46.76.03-87.72-27.37-87.72-45.48a18.45 18.45 0 0 1 1.51-7.33C22.27 52 .5 55 .5 74.22c0 31.48 74.59 70.28 133.65 70.28 45.28 0 56.7-20.48 56.7-36.65 0-12.72-11-27.16-30.83-35.78"
            fill="#e00"
          ></path>
        </svg>
        <ul>
          <li>Inline svg</li>
          <li>No title or img role</li>
          <li>aria-hidden="true"</li>
          <li>Should <strong>pass</strong></li>
        </ul>
      </div>
      <div>
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 200 145"
          class="redhat-logo"
          id="svg02"
          role="presentation"
        >
          <path
            d="M127.47 83.49c12.51 0 30.61-2.58 30.61-17.46a14 14 0 0 0-.31-3.42l-7.45-32.36c-1.72-7.12-3.23-10.35-15.73-16.6C124.89 8.69 103.76.5 97.51.5 91.69.5 90 8 83.06 8c-6.68 0-11.64-5.6-17.89-5.6-6 0-9.91 4.09-12.93 12.5 0 0-8.41 23.72-9.49 27.16a6.43 6.43 0 0 0-.22 1.94c0 9.22 36.3 39.45 84.94 39.45M160 72.07c1.73 8.19 1.73 9.05 1.73 10.13 0 14-15.74 21.77-36.43 21.77-46.76.03-87.72-27.37-87.72-45.48a18.45 18.45 0 0 1 1.51-7.33C22.27 52 .5 55 .5 74.22c0 31.48 74.59 70.28 133.65 70.28 45.28 0 56.7-20.48 56.7-36.65 0-12.72-11-27.16-30.83-35.78"
            fill="#e00"
          ></path>
        </svg>
        <ul>
          <li>Inline svg</li>
          <li>No title or img role</li>
          <li>role="presentation"</li>
          <li>Should <strong>pass</strong></li>
        </ul>
      </div>
      <div>
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 200 145"
          class="redhat-logo"
          id="svg03"
          role="img"
        >
          <title>Red Hat</title>
          <path
            d="M127.47 83.49c12.51 0 30.61-2.58 30.61-17.46a14 14 0 0 0-.31-3.42l-7.45-32.36c-1.72-7.12-3.23-10.35-15.73-16.6C124.89 8.69 103.76.5 97.51.5 91.69.5 90 8 83.06 8c-6.68 0-11.64-5.6-17.89-5.6-6 0-9.91 4.09-12.93 12.5 0 0-8.41 23.72-9.49 27.16a6.43 6.43 0 0 0-.22 1.94c0 9.22 36.3 39.45 84.94 39.45M160 72.07c1.73 8.19 1.73 9.05 1.73 10.13 0 14-15.74 21.77-36.43 21.77-46.76.03-87.72-27.37-87.72-45.48a18.45 18.45 0 0 1 1.51-7.33C22.27 52 .5 55 .5 74.22c0 31.48 74.59 70.28 133.65 70.28 45.28 0 56.7-20.48 56.7-36.65 0-12.72-11-27.16-30.83-35.78"
            fill="#e00"
          ></path>
        </svg>
        <ul>
          <li>Inline svg</li>
          <li>Has title and img role</li>
          <li>Not hidden from AT</li>
          <li>Should <strong>pass</strong></li>
        </ul>
      </div>
      <div>
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 200 145"
          class="redhat-logo"
          id="svg03"
          aria-label="Red Hat"
        >
          <path
            d="M127.47 83.49c12.51 0 30.61-2.58 30.61-17.46a14 14 0 0 0-.31-3.42l-7.45-32.36c-1.72-7.12-3.23-10.35-15.73-16.6C124.89 8.69 103.76.5 97.51.5 91.69.5 90 8 83.06 8c-6.68 0-11.64-5.6-17.89-5.6-6 0-9.91 4.09-12.93 12.5 0 0-8.41 23.72-9.49 27.16a6.43 6.43 0 0 0-.22 1.94c0 9.22 36.3 39.45 84.94 39.45M160 72.07c1.73 8.19 1.73 9.05 1.73 10.13 0 14-15.74 21.77-36.43 21.77-46.76.03-87.72-27.37-87.72-45.48a18.45 18.45 0 0 1 1.51-7.33C22.27 52 .5 55 .5 74.22c0 31.48 74.59 70.28 133.65 70.28 45.28 0 56.7-20.48 56.7-36.65 0-12.72-11-27.16-30.83-35.78"
            fill="#e00"
          ></path>
        </svg>
        <ul>
          <li>Inline svg</li>
          <li>No title or img role</li>
          <li>Has aria-label</li>
          <li>Not hidden from AT</li>
          <li>Should <strong>pass</strong></li>
        </ul>
      </div>
    </div>
    <h2>Shadow &lt;img&gt; elements</h2>
    <div class="cards">
      <div>
        <wc-img></wc-img>
        <ul>
          <li>Image component</li>
          <li>Has no alt</li>
          <li>Not hidden from AT</li>
          <li>No hidden parent</li>
          <li>Should <strong>fail</strong></li>
        </ul>
      </div>
      <div>
        <wc-div></wc-div>
        <ul>
          <li>Image component...</li>
          <li>Nested in component...</li>
          <li>In another component</li>
          <li>Has no alt</li>
          <li>Not hidden from AT</li>
          <li>No hidden parent</li>
          <li>Should <strong>fail</strong></li>
        </ul>
      </div>
    </div>
    <h2>Non-shadow JPG &lt;img&gt; elements</h2>
    <div class="cards">
      <div>
        <img src="testimg.jpg?test=img01" />
        <ul>
          <li>Has no alt</li>
          <li>Not hidden from AT</li>
          <li>No hidden parent</li>
          <li>Should <strong>fail</strong></li>
        </ul>
      </div>
      <div>
        <span aria-hidden="true"><img src="testimg.jpg?test=img02" /></span>
        <ul>
          <li>Has no alt</li>
          <li>Not hidden from AT</li>
          <li>AT-hidden parent</li>
          <li>Should <strong>pass</strong></li>
        </ul>
      </div>
      <div>
        <img src="testimg.jpg?test=img03" alt />
        <ul>
          <li>Empty alt</li>
          <li>Not hidden from AT</li>
          <li>No hidden parent</li>
          <li>Should <strong>pass</strong></li>
        </ul>
      </div>
      <div>
        <img src="testimg.jpg?test=img04" alt="People computing" />
        <ul>
          <li>alt with value</li>
          <li>Not hidden from AT</li>
          <li>No hidden parent</li>
          <li>Should <strong>pass</strong></li>
        </ul>
      </div>
      <div>
        <img src="testimg.jpg?test=img05" role="presentation" />
        <ul>
          <li>Has no alt</li>
          <li>role="presentation"</li>
          <li>No hidden parent</li>
          <li>Should <strong>pass</strong></li>
        </ul>
      </div>
    </div>
    <h2>Non-shadow SVG &lt;img&gt; elements</h2>
    <div class="cards">
      <div>
        <img src="testsvg.svg?test=svg01" />
        <ul>
          <li>Has no alt</li>
          <li>Not hidden from AT</li>
          <li>No hidden parent</li>
          <li>Should <strong>fail</strong></li>
        </ul>
      </div>
      <div>
        <span aria-hidden="true"><img src="testsvg.svg?test=svg02" /></span>
        <ul>
          <li>Has no alt</li>
          <li>Not hidden from AT</li>
          <li>AT-hidden parent</li>
          <li>Should <strong>pass</strong></li>
        </ul>
      </div>
      <div>
        <img src="testsvg.svg?test=svg03" alt />
        <ul>
          <li>Empty alt</li>
          <li>Not hidden from AT</li>
          <li>No hidden parent</li>
          <li>Should <strong>pass</strong></li>
        </ul>
      </div>
      <div>
        <img src="testsvg.svg?test=svg04" alt="People computing" />
        <ul>
          <li>alt with value</li>
          <li>Not hidden from AT</li>
          <li>No hidden parent</li>
          <li>Should <strong>pass</strong></li>
        </ul>
      </div>
      <div>
        <img src="testsvg.svg?test=svg05" role="presentation" />
        <ul>
          <li>Has no alt</li>
          <li>role="presentation"</li>
          <li>No hidden parent</li>
          <li>Should <strong>pass</strong></li>
        </ul>
      </div>
    </div>

    <script src="img-checker.js"></script>
  </body>
</html>
